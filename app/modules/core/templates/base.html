<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Admin</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f3f4f6; font-family: -apple-system, system-ui, "Segoe UI", Helvetica, Arial, sans-serif; }
        /* 侧边栏样式 */
        .sidebar {
            position: fixed; top: 0; bottom: 0; left: 0; z-index: 100;
            padding: 48px 0 0; box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
            background-color: #fff; width: 240px;
        }
        .sidebar .nav-link {
            font-weight: 500; color: #333; padding: 12px 24px;
            display: flex; align-items: center;
        }
        .sidebar .nav-link i { width: 24px; text-align: center; margin-right: 8px; color: #6c757d; }
        .sidebar .nav-link:hover { color: #007bff; background-color: #f8f9fa; }
        .sidebar .nav-link.active { color: #007bff; background-color: #e7f1ff; }
        .sidebar .nav-link.active i { color: #007bff; }
        
        /* 顶部导航 */
        .navbar-top {
            position: fixed; top: 0; right: 0; left: 240px; z-index: 101;
            height: 56px; background-color: #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            padding: 0 24px; display: flex; align-items: center; justify-content: space-between;
        }
        
        /* 主内容区 */
        .main-content {
            margin-left: 240px; padding: 80px 24px 24px;
        }
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            .sidebar.show { transform: translateX(0); }
            .navbar-top { left: 0; }
            .main-content { margin-left: 0; }
            .mobile-toggle { display: block !important; }
        }
        .mobile-toggle { display: none; border: none; background: none; font-size: 24px; color: #333; }
        
        /* 卡片通用 */
        .card { border: none; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.04); background: #fff; margin-bottom: 20px; }
        .card-header { background: transparent; border-bottom: 1px solid #f0f0f0; padding: 16px 20px; font-weight: 600; }
        .btn-primary { background-color: #007bff; border-color: #007bff; border-radius: 8px; }
    </style>
    {% block css %}{% endblock %}
</head>
<body>

<!-- 移动端遮罩 -->
<div id="sidebarOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:99;" onclick="toggleSidebar()"></div>

<!-- 侧边栏 -->
<nav class="sidebar" id="sidebar">
    <div class="px-4 mb-4 d-flex align-items-center">
        <i class="fa-brands fa-telegram fa-2x text-primary me-2"></i>
        <span class="fs-5 fw-bold">Bot Admin</span>
    </div>
    
    <div class="nav flex-column">
        {% if current_group %}
            <div class="text-uppercase text-muted fw-bold px-4 mb-2 mt-2" style="font-size: 12px;">当前群组: {{ current_group.title[:8] }}...</div>
            <a class="nav-link {% if page == 'dashboard' %}active{% endif %}" href="/core/group/{{ current_group.id }}/dashboard">
                <i class="fa-solid fa-chart-pie"></i> 仪表盘
            </a>
            <a class="nav-link {% if page == 'users' %}active{% endif %}" href="/core/group/{{ current_group.id }}/users">
                <i class="fa-solid fa-users"></i> 用户管理
            </a>
            <a class="nav-link {% if page == 'fields' %}active{% endif %}" href="/core/group/{{ current_group.id }}/fields">
                <i class="fa-solid fa-list-check"></i> 资料字段
            </a>
            <a class="nav-link {% if page == 'settings' %}active{% endif %}" href="/core/group/{{ current_group.id }}/settings">
                <i class="fa-solid fa-sliders"></i> 功能配置
            </a>
            <hr class="mx-3 my-2">
        {% endif %}
        
        <a class="nav-link text-dark" href="/core/select_group">
            <i class="fa-solid fa-exchange-alt"></i> 切换群组
        </a>
        <a class="nav-link text-danger" href="/core/logout">
            <i class="fa-solid fa-right-from-bracket"></i> 退出登录
        </a>
    </div>
</nav>

<!-- 顶部栏 -->
<header class="navbar-top">
    <button class="mobile-toggle me-3" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars"></i>
    </button>
    <h5 class="mb-0 fw-bold text-truncate">
        {% if current_group %}{{ current_group.title }}{% else %}控制台{% endif %}
    </h5>
    <div>
        <!-- 右侧预留 -->
    </div>
</header>

<!-- 主内容 -->
<main class="main-content">
    {% block content %}{% endblock %}
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function toggleSidebar() {
        const sb = document.getElementById('sidebar');
        const ol = document.getElementById('sidebarOverlay');
        sb.classList.toggle('show');
        ol.style.display = sb.classList.contains('show') ? 'block' : 'none';
    }
    
    async function postApi(url, data) {
        try {
            const res = await fetch(url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            const json = await res.json();
            if (json.status === 'ok') {
                alert(json.msg || '操作成功');
                location.reload();
            } else {
                alert('错误: ' + (json.msg || '未知错误'));
            }
        } catch(e) { alert('网络请求失败'); }
    }
</script>
{% block scripts %}{% endblock %}
</body>
</html>
