<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary-color: #4e73df; --bg-color: #f8f9fc; }
        body { background-color: var(--bg-color); font-family: 'Segoe UI', Roboto, sans-serif; color: #5a5c69; }
        
        /* 导航栏美化 */
        .navbar { background: white; box-shadow: 0 .15rem 1.75rem 0 rgba(58,59,69,.15); padding: 0.8rem 1rem; }
        .navbar-brand { font-weight: 800; letter-spacing: 1px; color: var(--primary-color) !important; }
        
        /* 卡片美化 */
        .card { border: none; border-radius: 0.75rem; box-shadow: 0 .15rem 1.75rem 0 rgba(58,59,69,.15); transition: transform 0.2s; }
        .card:hover { transform: translateY(-3px); }
        .card-header { background-color: #f8f9fc; border-bottom: 1px solid #e3e6f0; padding: 1rem 1.25rem; font-weight: 700; color: var(--primary-color); border-top-left-radius: 0.75rem !important; border-top-right-radius: 0.75rem !important; }
        
        /* 侧边栏 (仅在管理页显示) */
        .sidebar-wrapper { min-height: 100vh; background: #4e73df; background: linear-gradient(180deg,#4e73df 10%,#224abe 100%); width: 224px; position: fixed; left: 0; top: 0; bottom: 0; z-index: 1000; padding-top: 1rem; }
        .sidebar-brand { color: white; text-decoration: none; font-weight: 800; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; padding-bottom: 1.5rem; margin-bottom: 1rem; border-bottom: 1px solid rgba(255,255,255,0.15); }
        .nav-item .nav-link { color: rgba(255,255,255,.8); padding: 1rem; margin: 0 1rem; border-radius: 0.35rem; display: block; text-decoration: none; font-weight: 600; }
        .nav-item .nav-link:hover { color: white; background: rgba(255,255,255,0.1); }
        .nav-item .nav-link.active { background: white; color: #4e73df; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .nav-item .nav-link i { width: 20px; margin-right: 0.5rem; text-align: center; }
        
        /* 主内容偏移 */
        .main-content-wrapper { margin-left: 224px; min-height: 100vh; display: flex; flex-direction: column; }
        .top-bar { height: 70px; background: white; box-shadow: 0 .15rem 1.75rem 0 rgba(58,59,69,.15); display: flex; align-items: center; justify-content: flex-end; padding: 0 2rem; margin-bottom: 1.5rem; }
        
        /* 全屏模式 (选择群组页) */
        .fullscreen-wrapper { width: 100%; min-height: 100vh; }
        
        @media (max-width: 768px) {
            .sidebar-wrapper { display: none; }
            .main-content-wrapper { margin-left: 0; }
            .top-bar { justify-content: space-between; }
        }
    </style>
</head>
<body>

{% if current_group and page != 'select_group' %}
    <!-- 1. 管理模式布局 (左侧菜单 + 右侧内容) -->
    <div class="sidebar-wrapper">
        <a href="/core" class="sidebar-brand">
            <i class="fa-solid fa-robot me-2"></i> Bot Admin
        </a>
        <div class="nav-item mb-2">
            <a class="nav-link {% if page == 'dashboard' %}active{% endif %}" href="/core/group/{{ current_group.id }}/dashboard">
                <i class="fa-solid fa-gauge-high"></i> 仪表盘
            </a>
        </div>
        <div class="nav-item mb-2">
            <a class="nav-link {% if page == 'users' %}active{% endif %}" href="/core/group/{{ current_group.id }}/users">
                <i class="fa-solid fa-users"></i> 用户管理
            </a>
        </div>
        <div class="nav-item mb-2">
            <a class="nav-link {% if page == 'fields' %}active{% endif %}" href="/core/group/{{ current_group.id }}/fields">
                <i class="fa-solid fa-pen-to-square"></i> 资料字段
            </a>
        </div>
        <div class="nav-item mb-2">
            <a class="nav-link {% if page == 'settings' %}active{% endif %}" href="/core/group/{{ current_group.id }}/settings">
                <i class="fa-solid fa-gear"></i> 功能配置
            </a>
        </div>
        <hr style="border-top: 1px solid rgba(255,255,255,0.15); margin: 1.5rem 1rem;">
        <div class="nav-item">
            <a class="nav-link text-warning" href="/core/select_group">
                <i class="fa-solid fa-arrow-left"></i> 切换群组
            </a>
        </div>
    </div>

    <div class="main-content-wrapper">
        <!-- 顶部栏 -->
        <div class="top-bar">
            <!-- 手机端菜单按钮 (仅占位) -->
            <div class="d-md-none fw-bold text-primary">{{ current_group.title }}</div>
            
            <div class="d-flex align-items-center">
                <span class="mr-2 d-none d-lg-inline text-gray-600 small me-3">{{ current_group.title }}</span>
                <a href="/core/logout" class="btn btn-sm btn-circle btn-light shadow-sm text-danger">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </div>
        </div>
        <!-- 内容区 -->
        <div class="container-fluid pb-5">
            {% block content %}{% endblock %}
        </div>
    </div>

{% else %}
    <!-- 2. 全屏模式布局 (选择群组页) -->
    <div class="fullscreen-wrapper">
        <nav class="navbar navbar-light bg-white static-top shadow-sm mb-4">
            <div class="container">
                <a class="navbar-brand" href="#"><i class="fa-solid fa-robot me-2"></i>Bot Manager</a>
                {% if session.get('logged_in') %}
                <a class="btn btn-outline-danger btn-sm" href="/core/logout">退出</a>
                {% endif %}
            </div>
        </nav>
        <div class="container">
            {% block full_content %}{% endblock %}
        </div>
    </div>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    async function postApi(url, data) {
        try {
            const res = await fetch(url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            });
            const json = await res.json();
            if (json.status === 'ok') { alert('✅ 操作成功'); location.reload(); } 
            else { alert('❌ 失败: ' + (json.msg || '未知错误')); }
        } catch (e) { alert('❌ 网络错误: ' + e); }
    }
</script>
{% block scripts %}{% endblock %}
</body>
</html>
